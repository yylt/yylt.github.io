<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>Containerd系列-简介 - </title><meta name="Description" content="containerd 入门篇"><meta property="og:title" content="Containerd系列-简介" />
<meta property="og:description" content="containerd 入门篇" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://yylt.github.io/2020/12/containerd%E7%B3%BB%E5%88%97-%E7%AE%80%E4%BB%8B/" /><meta property="og:image" content="https://yylt.github.io"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-12-09T15:50:43+08:00" />
<meta property="article:modified_time" content="2020-12-09T15:50:43+08:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://yylt.github.io"/>

<meta name="twitter:title" content="Containerd系列-简介"/>
<meta name="twitter:description" content="containerd 入门篇"/>
<meta name="application-name" content="yylt&#39;s 博客">
<meta name="apple-mobile-web-app-title" content="yylt&#39;s 博客"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://yylt.github.io/2020/12/containerd%E7%B3%BB%E5%88%97-%E7%AE%80%E4%BB%8B/" /><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Containerd系列-简介",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/yylt.github.io\/2020\/12\/containerd%E7%B3%BB%E5%88%97-%E7%AE%80%E4%BB%8B\/"
        },"image": ["https:\/\/yylt.github.io\/images\/Apple-Devices-Preview.png"],"genre": "posts","keywords": "containerd, go","wordcount":  3900 ,
        "url": "https:\/\/yylt.github.io\/2020\/12\/containerd%E7%B3%BB%E5%88%97-%E7%AE%80%E4%BB%8B\/","datePublished": "2020-12-09T15:50:43+08:00","dateModified": "2020-12-09T15:50:43+08:00","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
            "@type": "Organization",
            "name": "xxxx","logo": "https:\/\/yylt.github.io\/images\/avatar.jpg"},"author": {
                "@type": "Person",
                "name": "yylt"
            },"description": "containerd 入门篇"
    }
    </script></head>
    <body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title=""><span class="header-title-pre"><i class='far fa-kiss-wink-heart fa-fw'></i></span>yylt&#39;s 博客</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> 所有文章 </a><a class="menu-item" href="/tags/"> 标签 </a><a class="menu-item" href="/categories/"> 分类 </a><a class="menu-item" href="/about/"> 关于 </a><a class="menu-item" href="https://github.com/yylt" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i>  </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item language" title="选择语言">简体中文<i class="fas fa-chevron-right fa-fw"></i>
                        <select class="language-select" id="language-select-desktop" onchange="location = this.value;"><option value="/2020/12/containerd%E7%B3%BB%E5%88%97-%E7%AE%80%E4%BB%8B/" selected>简体中文</option></select>
                    </a><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="搜索">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="清空">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title=""><span class="header-title-pre"><i class='far fa-kiss-wink-heart fa-fw'></i></span>yylt&#39;s 博客</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="搜索">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="清空">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        取消
                    </a>
                </div><a class="menu-item" href="/posts/" title="">所有文章</a><a class="menu-item" href="/tags/" title="">标签</a><a class="menu-item" href="/categories/" title="">分类</a><a class="menu-item" href="/about/" title="">关于</a><a class="menu-item" href="https://github.com/yylt" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i></a><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                <i class="fas fa-adjust fa-fw"></i>
            </a><a href="javascript:void(0);" class="menu-item" title="选择语言">简体中文<i class="fas fa-chevron-right fa-fw"></i>
                    <select class="language-select" onchange="location = this.value;"><option value="/2020/12/containerd%E7%B3%BB%E5%88%97-%E7%AE%80%E4%BB%8B/" selected>简体中文</option></select>
                </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">目录</h2>
            <div class="toc-content always-active" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">Containerd系列-简介</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="https://yylt.github.io" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw"></i>yylt</a></span>&nbsp;<span class="post-category">收录于 <a href="/categories/container/"><i class="far fa-folder fa-fw"></i>container</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2020-12-09">2020-12-09</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 3900 字&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 8 分钟&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>目录</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#历史">历史</a></li>
    <li><a href="#架构">架构</a></li>
    <li><a href="#glossary">glossary</a></li>
    <li><a href="#服务">服务</a>
      <ul>
        <li><a href="#diff">diff</a></li>
        <li><a href="#scheduler">scheduler</a></li>
        <li><a href="#monitor">monitor</a></li>
        <li><a href="#cgroup">cgroup</a></li>
        <li><a href="#runtime-v1">runtime v1</a></li>
        <li><a href="#runtime-v2">runtime v2</a></li>
        <li><a href="#snapshot">snapshot</a></li>
      </ul>
    </li>
    <li><a href="#services">services</a>
      <ul>
        <li><a href="#containerimageleasenamespace">container/image/lease/namespace</a></li>
        <li><a href="#content">content</a></li>
        <li><a href="#task">task</a></li>
        <li><a href="#diff-1">diff</a></li>
        <li><a href="#event">event</a></li>
        <li><a href="#introspection">introspection</a></li>
        <li><a href="#healthcheck">healthcheck</a></li>
        <li><a href="#version">version</a></li>
        <li><a href="#opt">opt</a></li>
        <li><a href="#server">==server==</a></li>
      </ul>
    </li>
    <li><a href="#cri">cri</a>
      <ul>
        <li><a href="#仓库配置">仓库配置</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h2 id="历史">历史</h2>
<ul>
<li>Docker Daemon从最初集成在docker命令中（1.11版本前），</li>
<li>独立成单独二进制程序（1.11版本开始）2016.12
<ul>
<li>containerd是容器技术标准化之后的产物，为了能够兼容OCI标准，从Docker Daemon剥离</li>
<li>containerd分v0.2.x ， v1.x版本
<ul>
<li>v0.2.x 由docker daemon集成</li>
<li>v1.x 开始支持oci标准</li>
</ul>
</li>
<li>containerd项目地址： github.com/docker/containerd</li>
</ul>
</li>
<li>containerd捐献给cncf 2017.03
<ul>
<li>项目地址修改为 github.com/containerd/containerd</li>
<li>v1.0.0正式版发布 2017.12 支持OCI接口</li>
<li>v1.1.0正式版 2018.4 支持CRI接口</li>
<li>v1.2.0正式版 2018.10 runtime v2稳定</li>
</ul>
</li>
<li>shim
<ul>
<li>shim是一个真实运行的容器的真实载体</li>
</ul>
</li>
</ul>
<h2 id="架构">架构</h2>
<ul>
<li>组件如图</li>
</ul>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/containerd-arch.png"
        data-srcset="/images/containerd-arch.png, /images/containerd-arch.png 1.5x, /images/containerd-arch.png 2x"
        data-sizes="auto"
        alt="/images/containerd-arch.png"
        title="1" /></p>
<h2 id="glossary">glossary</h2>
<ul>
<li>
<p>服务： 提供grpc服务</p>
</li>
<li>
<p>sandbox：一种特殊容器，主要作用准备容器隔离的环境，包括网络，io目录，cgroup parent</p>
</li>
<li>
<p>container：业务容器，每个进程都由一个task 管理</p>
</li>
<li>
<p>shim：管理器(containerd) 和 runtime的粘和层，因为runc是二进制文件执行，无法常驻内存，使用shim一方面方便管理，另一方面扩展runtime; shim管理 sandbox + container(s)</p>
</li>
<li>
<p>task：代表进程+io</p>
</li>
<li>
<p>runtime v2: 可以理解 task 管理器</p>
</li>
</ul>
<h2 id="服务">服务</h2>
<ul>
<li>每个服务都是plugin方式加入，包括不限于image, runtime, grpc server等</li>
<li>plugin特点
<ul>
<li>插件URI为 Type+ID，如 <code>io.containerd.snapshotter.v1.overlayfs</code>，io.containerd.snapshotter.v1是Type，overlayfs是ID</li>
<li>插件类型之间有依赖, 从下向上排序：
<ul>
<li>ContentPlugin， SnapshotPlugin</li>
<li>MetadataPlugin</li>
<li>GCPlugin，RuntimePlugin，DiffPlugin</li>
<li>ServicePlugin</li>
<li>InternalPlugin，GRPCPlugin</li>
</ul>
</li>
</ul>
</li>
<li>数据结构</li>
</ul>
<div class="mermaid" id="id-1"></div>
<h3 id="diff">diff</h3>
<ul>
<li>用于snaphost的操作</li>
<li>diff/walking/plugin目录， DiffPlugin类型，依赖MetadataPlugin</li>
<li>提供两个方法
<ul>
<li><code>Compare</code> 根据提供的 lower，upper 信息，得到oscispec.Descriptor</li>
<li><code>Apply</code> 从镜像压缩文件中读取内容，并按序执行多个处理器，主要是校验，解压，自定义插件等</li>
</ul>
</li>
</ul>
<h3 id="scheduler">scheduler</h3>
<ul>
<li>调度器，gc/scheduler目录， GCPlugin类型，依赖MetadataPlugin</li>
<li>配置信息
<ul>
<li>PauseThreshold: 暂停阈值，平均每秒2%的暂停时间，使用该值计算下次等待周期，默认为0.02, 最大值0.5</li>
<li>DeletionThreshold：删除阈值，在删除多少次之后至少保证发生gc调度，0表示不会被删除触发，默认0</li>
<li>MutationThreshold： 突变阈值</li>
<li>ScheduleDelay：调度延迟，当发生手动触发或者阈值触发后，延迟多久才开始GC，默认0ms</li>
<li>StartupDelay： 慢启动，默认100ms</li>
</ul>
</li>
<li>goroutine
<ul>
<li>gc实际是执行content.GarbageCollect</li>
</ul>
</li>
</ul>
<h3 id="monitor">monitor</h3>
<ul>
<li>容器的起停状态同步， InternalPlugin类型，依赖ServicePlugin</li>
<li>goroutine
<ul>
<li>过滤标签 <code>containerd.io/restart.status</code>的container</li>
<li>对比container和预期状态是否相符</li>
<li>重新执行start或stop</li>
</ul>
</li>
</ul>
<h3 id="cgroup">cgroup</h3>
<ul>
<li>进程oom监听和指标统计，在 metrics/cgroup 目录， TaskMonitorPlugin类型</li>
<li>作用：task的指标和oom监听</li>
<li>主要是shim 在使用该模块，shim需要监听 task 是否发生OOM</li>
</ul>
<h3 id="runtime-v1">runtime v1</h3>
<ul>
<li>容器进程管理器,， RuntimePlugin类型，依赖MetadataPlugin</li>
<li>配置
<ul>
<li>shim： shim二进制文件地址</li>
<li>runtime： 被shim使用的runtime二进制文件地址</li>
<li>no_shim： 直接调用runtime，跳过shim</li>
<li>shim_debug： 是否打开shim调试</li>
</ul>
</li>
</ul>
<h3 id="runtime-v2">runtime v2</h3>
<ul>
<li>容器进程管理器, RuntimePluginV2类型，依赖MetadataPlugin</li>
<li>在<a href="https://github.com/containerd/containerd/blob/34fb8d8967595292adce04b53b12ee33499cd6b8/client.go#L102" target="_blank" rel="noopener noreffer">client</a>中被配置为默认的runtime</li>
<li>初始化时会执行以下内容
<ul>
<li>创建目录 {root/state}/io.containerd.runtime.v2.task</li>
<li>读取 {state}/io.containerd.runtime.v2.task目录</li>
<li>恢复shim 管理</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">tips：
fifo文件ro打开：当无写端，若是nonblocking模式，则返回，否则阻塞
fifo文件wo打开：当无读端，返回ENXIO，若读端关闭时写数据，则返回SIGPIPE
fifo文件rw打开：总是成功
</code></pre></td></tr></table>
</div>
</div><h3 id="snapshot">snapshot</h3>
<ul>
<li>容器的rootfs管理器，SnapshotPlugin类型</li>
<li>linux 平台
<ul>
<li>snapshots/{native, overlay, devmapper，btrfs}</li>
<li>containerd/{aufs,zfs}</li>
</ul>
</li>
<li>windows平台
<ul>
<li>snapshots/{lcow, windows}</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># man 8 mount</span>
<span class="c1"># references: https://wiki.archlinux.org/title/Overlay_filesystem</span>
tips:
<span class="m">1</span> overlay 挂载
mount -t overlay  overlay -o <span class="nv">lowerdir</span><span class="o">=</span>/lower:/lower2,upperdir<span class="o">=</span>/upper,workdir<span class="o">=</span>/work  /merged
// upperdir 一般是可写层
// workdir 空目录，
<span class="m">2</span> devmapper 挂载
mount -t ext4 /dev/mapper/xx <span class="o">{</span>target<span class="o">}</span>
<span class="m">3</span> native 挂载
mount -t <span class="nb">bind</span> <span class="o">{</span>src<span class="o">}</span> <span class="o">{</span>dst<span class="o">}</span>
<span class="m">4</span> btrfs 
mount -t btrfs 
</code></pre></td></tr></table>
</div>
</div><h2 id="services">services</h2>
<ul>
<li>提供rpc服务和数据库操作等</li>
<li>services/目录下，具体有以下的内容</li>
</ul>
<h3 id="containerimageleasenamespace">container/image/lease/namespace</h3>
<ul>
<li>local.go: 是service Plugin类型，对数据库的操作，以及event的发送</li>
<li>service.go: 是grpc Plugin类型，提供grpc服务，并使用local内相同接口</li>
</ul>
<h3 id="content">content</h3>
<ul>
<li>service.go: 提供grpc服务，CRUD content数据</li>
<li>contentserver : content具体操作(content)</li>
</ul>
<h3 id="task">task</h3>
<ul>
<li>local.go: 调用runtime v2同名接口，包括容器创建，开始，结束，删除，终端，状态等信息</li>
<li>server.go: 提供grpc服务</li>
</ul>
<h3 id="diff-1">diff</h3>
<ul>
<li>local.go: 使用diff插件</li>
<li>service.go: 提供grpc服务</li>
</ul>
<h3 id="event">event</h3>
<ul>
<li>service.go: 提供grpc服务，包括转发，推送，订阅功能</li>
</ul>
<h3 id="introspection">introspection</h3>
<ul>
<li>service.go: 提供grpc服务，列举注册的plugin</li>
</ul>
<h3 id="healthcheck">healthcheck</h3>
<ul>
<li>service.go: 提供 grpc服务，检查指定服务的健康</li>
</ul>
<h3 id="version">version</h3>
<ul>
<li>service.go: 提供 grpc服务，检查containerd version</li>
</ul>
<h3 id="opt">opt</h3>
<ul>
<li>配置目录 root
<ul>
<li>添加 {root}/bin 到环境变量 PATH中</li>
<li>添加 {root}/lib 到环境变量LD_LIBRARY_PATH中</li>
</ul>
</li>
</ul>
<h3 id="server">==server==</h3>
<ul>
<li>基础plugin，扩展插件的初始化和服务启动
<ul>
<li>流程
<ul>
<li>注册 ContentPlugin插件</li>
<li>注册 MetadataPlugin插件</li>
<li>注册 proxy插件(ContentPlugin或SnapshotPlugin类型)</li>
<li>注册DiffPlugin插件 (stream processor类型)，目前主要是处理 加密的镜像</li>
</ul>
</li>
<li>监听event类型
<ul>
<li>/tasks/oom</li>
<li>/images/</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-toml" data-lang="toml"><span class="nx">version</span> <span class="p">=</span> <span class="mi">2</span>
<span class="nx">root</span> <span class="p">=</span> <span class="s2">&#34;/var/lib/mycontainerd&#34;</span> <span class="c">#持久化目录</span>
<span class="nx">state</span> <span class="p">=</span> <span class="s2">&#34;/var/run/mycontainerd&#34;</span> <span class="c">#非持久化目录</span>
<span class="nx">oom_score</span> <span class="p">=</span> <span class="mi">0</span> <span class="c"># containerd的oom分数</span>
<span class="p">...</span>
<span class="p">[</span><span class="nx">proxy_plugins</span><span class="p">]</span>
  <span class="p">[</span><span class="nx">proxy_plugins</span><span class="p">.</span><span class="nx">stargz</span><span class="p">]</span>
    <span class="nx">type</span> <span class="p">=</span> <span class="s2">&#34;snapshot&#34;</span> <span class="c">#支持snapshot和content类型</span>
    <span class="nx">address</span> <span class="p">=</span> <span class="s2">&#34;/run/containerd-stargz-grpc/containerd-stargz-grpc.sock&#34;</span>
<span class="p">[</span><span class="nx">stream_processors</span><span class="p">]</span>
  <span class="p">[</span><span class="nx">stream_processors</span><span class="p">.</span><span class="s2">&#34;io.containerd.ocicrypt.decoder.v1.tar.gzip&#34;</span><span class="p">]</span>
    <span class="nx">accepts</span> <span class="p">=</span> <span class="p">[</span><span class="s2">&#34;application/vnd.oci.image.layer.v1.tar+gzip+encrypted&#34;</span><span class="p">]</span>
    <span class="nx">returns</span> <span class="p">=</span> <span class="s2">&#34;application/vnd.oci.image.layer.v1.tar+gzip&#34;</span>
    <span class="nx">path</span> <span class="p">=</span> <span class="s2">&#34;/usr/local/bin/ctd-decoder&#34;</span>

<span class="p">[</span><span class="nx">cgroup</span><span class="p">]</span>
  <span class="nx">path</span> <span class="p">=</span> <span class="s2">&#34;&#34;</span> <span class="c"># containerd 所在路径，去除 ‘/sys/fs/cgroup/&#39;前缀的</span>
<span class="p">[</span><span class="nx">plugins</span><span class="p">]</span>
  <span class="p">[</span><span class="nx">plugins</span><span class="p">.</span><span class="s2">&#34;io.containerd.gc.v1.scheduler&#34;</span><span class="p">]</span>
    <span class="nx">pause_threshold</span> <span class="p">=</span> <span class="mf">0.02</span>
    <span class="nx">deletion_threshold</span> <span class="p">=</span> <span class="mi">0</span>
    <span class="nx">mutation_threshold</span> <span class="p">=</span> <span class="mi">100</span>
    <span class="nx">schedule_delay</span> <span class="p">=</span> <span class="s2">&#34;0s&#34;</span>
    <span class="nx">startup_delay</span> <span class="p">=</span> <span class="s2">&#34;100ms&#34;</span>
  <span class="p">[</span><span class="nx">plugins</span><span class="p">.</span><span class="s2">&#34;io.containerd.internal.v1.restart&#34;</span><span class="p">]</span>
    <span class="nx">interval</span> <span class="p">=</span> <span class="s2">&#34;10s&#34;</span> <span class="c">#restart插件，遍历container的周期</span>
  <span class="p">[</span><span class="nx">plugins</span><span class="p">.</span><span class="s2">&#34;io.containerd.metadata.v1.bolt&#34;</span><span class="p">]</span>
    <span class="nx">content_sharing_policy</span> <span class="p">=</span> <span class="s2">&#34;shared&#34;</span> <span class="c">#content策略，shared则所有不同ns的都可以访问，另一种是isolated</span>
  <span class="p">[</span><span class="nx">plugins</span><span class="p">.</span><span class="s2">&#34;io.containerd.monitor.v1.cgroups&#34;</span><span class="p">]</span>
    <span class="nx">no_prometheus</span> <span class="p">=</span> <span class="kc">false</span>
  <span class="p">[</span><span class="nx">plugins</span><span class="p">.</span><span class="s2">&#34;io.containerd.runtime.v1.linux&#34;</span><span class="p">]</span>
    <span class="nx">shim</span> <span class="p">=</span> <span class="s2">&#34;containerd-shim&#34;</span>
    <span class="nx">runtime</span> <span class="p">=</span> <span class="s2">&#34;runc&#34;</span>
    <span class="nx">runtime_root</span> <span class="p">=</span> <span class="s2">&#34;&#34;</span>
    <span class="nx">no_shim</span> <span class="p">=</span> <span class="kc">false</span>
    <span class="nx">shim_debug</span> <span class="p">=</span> <span class="kc">false</span>
  <span class="p">[</span><span class="nx">plugins</span><span class="p">.</span><span class="s2">&#34;io.containerd.runtime.v2.task&#34;</span><span class="p">]</span>
    <span class="nx">platforms</span> <span class="p">=</span> <span class="p">[</span><span class="s2">&#34;linux/amd64&#34;</span><span class="p">]</span> <span class="c">#镜像支持的平台类型</span>
  <span class="p">[</span><span class="nx">plugins</span><span class="p">.</span><span class="s2">&#34;io.containerd.service.v1.diff-service&#34;</span><span class="p">]</span>
    <span class="nx">default</span> <span class="p">=</span> <span class="p">[</span><span class="s2">&#34;walking&#34;</span><span class="p">]</span> <span class="c">#walking是内置的diff插件</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="cri">cri</h2>
<ul>
<li>提供grpc 服务，GRPCPlugin类型，依赖ServicePlugin</li>
<li>cri 常见配置</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-toml" data-lang="toml"><span class="p">[</span><span class="nx">plugins</span><span class="p">.</span><span class="nx">cri</span><span class="p">]</span>
    <span class="nx">disable_tcp_service</span> <span class="p">=</span> <span class="kc">true</span>
    <span class="nx">stream_server_address</span> <span class="p">=</span> <span class="s2">&#34;127.0.0.1&#34;</span> <span class="c"># unix 监听地址</span>
    <span class="nx">stream_server_port</span> <span class="p">=</span> <span class="s2">&#34;0&#34;</span> <span class="c"># unix 监听端口,0是随机分配</span>
    <span class="nx">stream_idle_timeout</span> <span class="p">=</span> <span class="s2">&#34;4h0m0s&#34;</span> <span class="c">#idle连接超时时间</span>
    <span class="nx">enable_selinux</span> <span class="p">=</span> <span class="kc">false</span> 
    <span class="nx">sandbox_image</span> <span class="p">=</span> <span class="s2">&#34;hub.easystack.io/captain/pause-amd64:3.0&#34;</span>
    <span class="nx">stats_collect_period</span> <span class="p">=</span> <span class="mi">10</span> <span class="c">#单位秒，snapshot状态收集</span>
    <span class="nx">systemd_cgroup</span> <span class="p">=</span> <span class="kc">false</span> <span class="c">#只适用io.containerd.runtime.v1.linux</span>
    <span class="nx">enable_tls_streaming</span> <span class="p">=</span> <span class="kc">false</span> <span class="c"># 是否支持tls</span>
    <span class="nx">max_container_log_line_size</span> <span class="p">=</span> <span class="mi">16384</span> <span class="c">#单行日志最大byte</span>
    <span class="nx">disable_cgroup</span> <span class="p">=</span> <span class="kc">false</span> <span class="c"># 当rootless 运行时，需要设置为true</span>
    <span class="nx">disable_apparmor</span> <span class="p">=</span> <span class="kc">false</span>
    <span class="nx">restrict_oom_score_adj</span> <span class="p">=</span> <span class="kc">false</span>
    <span class="nx">netns_mounts_under_state_dir</span> <span class="p">=</span> <span class="kc">false</span> <span class="c">#将net ns设置到{state}/netns目录下,而不是默认的/run/netns下</span>
    <span class="nx">max_concurrent_downloads</span> <span class="p">=</span> <span class="mi">3</span>
    <span class="nx">unset_seccomp_profile</span> <span class="p">=</span> <span class="s2">&#34;&#34;</span> <span class="c">#seccomp配置文件</span>
    <span class="nx">disable_proc_mount</span> <span class="p">=</span> <span class="kc">false</span> <span class="c">#禁用k8s ProcMount， 对于k8s &lt;= 1.11时，必须设置为true</span>
    
      <span class="nx">tolerate_missing_hugetlb_controller</span> <span class="p">=</span> <span class="kc">true</span> <span class="c">#1.5+,对于k8s &lt;1.19,不支持配置hugetlb</span>
      <span class="nx">disable_hugetlb_controller</span> <span class="p">=</span> <span class="kc">true</span> <span class="c">#1.5+, 适用于rootless+cgroupv2+systemd</span>
      <span class="nx">ignore_image_defined_volumes</span> <span class="p">=</span> <span class="kc">true</span> <span class="c">#1.5+，创建container时，忽略image中定义的volume</span>
    <span class="p">[</span><span class="nx">plugins</span><span class="p">.</span><span class="nx">cri</span><span class="p">.</span><span class="nx">x509_key_pair_streaming</span><span class="p">]</span> <span class="c">#stream tls配置</span>
      <span class="nx">tls_cert_file</span> <span class="p">=</span> <span class="s2">&#34;&#34;</span>
      <span class="nx">tls_key_file</span> <span class="p">=</span> <span class="s2">&#34;&#34;</span>
    <span class="p">[</span><span class="nx">plugins</span><span class="p">.</span><span class="nx">cri</span><span class="p">.</span><span class="nx">image_decryption</span><span class="p">]</span> <span class="c"># 解密镜像，参考项目 github.com/containerd/imgcrypt</span>
      <span class="nx">key_model</span> <span class="p">=</span> <span class="nx">none</span>
    <span class="p">[</span><span class="nx">plugins</span><span class="p">.</span><span class="nx">cri</span><span class="p">.</span><span class="nx">containerd</span><span class="p">]</span>
      <span class="nx">snapshotter</span> <span class="p">=</span> <span class="s2">&#34;overlayfs&#34;</span> <span class="c">#使用何种snapshot</span>
      <span class="nx">default_runtime_name</span> <span class="p">=</span> <span class="s2">&#34;runc&#34;</span> <span class="c">#默认runtime，必须出现在后续的列表中</span>
      <span class="nx">no_pivot</span> <span class="p">=</span> <span class="kc">false</span> <span class="c">#只适用io.containerd.runtime.v1.linux</span>
        <span class="nx">disable_snapshot_annotations</span> <span class="p">=</span> <span class="kc">false</span> <span class="c">#stargz snapshot需要配置</span>
          <span class="nx">discard_unpacked_layers</span> <span class="p">=</span> <span class="kc">false</span> <span class="c">#当执行content GC时，是否回收已经unpack的content</span>
      <span class="p">[</span><span class="nx">plugins</span><span class="p">.</span><span class="nx">cri</span><span class="p">.</span><span class="nx">containerd</span><span class="p">.</span><span class="nx">default_runtime</span><span class="p">]</span> <span class="c">#被弃用</span>
        <span class="nx">privileged_without_host_devices</span> <span class="p">=</span> <span class="kc">false</span> <span class="c"># 设置特权模式下时，是否映射主机上设备到容器内</span>
      <span class="p">[</span><span class="nx">plugins</span><span class="p">.</span><span class="nx">cri</span><span class="p">.</span><span class="nx">containerd</span><span class="p">.</span><span class="nx">untrusted_workload_runtime</span><span class="p">]</span> <span class="c">#被弃用</span>
        <span class="nx">privileged_without_host_devices</span> <span class="p">=</span> <span class="kc">false</span>
      <span class="p">[</span><span class="nx">plugins</span><span class="p">.</span><span class="nx">cri</span><span class="p">.</span><span class="nx">containerd</span><span class="p">.</span><span class="nx">runtimes</span><span class="p">]</span>
        <span class="p">[</span><span class="nx">plugins</span><span class="p">.</span><span class="nx">cri</span><span class="p">.</span><span class="nx">containerd</span><span class="p">.</span><span class="nx">runtimes</span><span class="p">.</span><span class="nx">runc</span><span class="p">]</span>
          <span class="nx">runtime_type</span> <span class="p">=</span> <span class="s2">&#34;io.containerd.runc.v2&#34;</span> <span class="c">#将被用于解析为具体二进制文件名</span>
          <span class="p">[</span><span class="nx">plugins</span><span class="p">.</span><span class="nx">cri</span><span class="p">.</span><span class="nx">containerd</span><span class="p">.</span><span class="nx">runtimes</span><span class="p">.</span><span class="nx">runc</span><span class="p">.</span><span class="nx">options</span><span class="p">]</span>
        <span class="c"># NoPivotRoot disables pivot root when creating a container.</span>
            <span class="nx">NoPivotRoot</span> <span class="p">=</span> <span class="kc">false</span>
        <span class="c"># NoNewKeyring disables new keyring for the container.</span>
            <span class="nx">NoNewKeyring</span> <span class="p">=</span> <span class="kc">false</span>
        <span class="c"># 设置shim cgroup目录，默认是和containerd一起</span>
            <span class="nx">ShimCgroup</span> <span class="p">=</span> <span class="s2">&#34;&#34;</span>
        <span class="c"># 设置shim log user id.</span>
            <span class="nx">IoUid</span> <span class="p">=</span> <span class="mi">0</span>
        <span class="c"># 设置shim log group id.</span>
            <span class="nx">IoGid</span> <span class="p">=</span> <span class="mi">0</span>
        <span class="c"># 设置二进制文件名，否则将使用type字段</span>
            <span class="nx">BinaryName</span> <span class="p">=</span> <span class="s2">&#34;&#34;</span>
        <span class="c"># runc的目录，默认为 {state}/runc.</span>
            <span class="nx">Root</span> <span class="p">=</span> <span class="s2">&#34;&#34;</span>
        <span class="c"># criu 二进制文件路径.</span>
            <span class="nx">CriuPath</span> <span class="p">=</span> <span class="s2">&#34;&#34;</span>
        <span class="c"># 使用cgroup的systemd 驱动，注意需要和kubelet中同样设置</span>
            <span class="nx">SystemdCgroup</span> <span class="p">=</span> <span class="kc">true</span>
        <span class="c"># CriuImagePath is the criu image path</span>
            <span class="nx">CriuImagePath</span> <span class="p">=</span> <span class="s2">&#34;&#34;</span>
        <span class="c"># CriuWorkPath is the criu work path.</span>
            <span class="nx">CriuWorkPath</span> <span class="p">=</span> <span class="s2">&#34;&#34;</span>
          <span class="nx">privileged_without_host_devices</span> <span class="p">=</span> <span class="kc">false</span>
        <span class="p">[</span><span class="nx">plugins</span><span class="p">.</span><span class="nx">cri</span><span class="p">.</span><span class="nx">containerd</span><span class="p">.</span><span class="nx">runtimes</span><span class="p">.</span><span class="nx">gvisor</span><span class="p">]</span>
          <span class="nx">runtime_type</span> <span class="p">=</span> <span class="s2">&#34;io.containerd.gvisor.v2&#34;</span>
          <span class="nx">pod_annotations</span> <span class="p">=[</span><span class="s2">&#34;&#34;</span><span class="p">]</span>
          <span class="nx">container_annotations</span> <span class="p">=</span> <span class="p">[</span><span class="s2">&#34;&#34;</span><span class="p">]</span>
          <span class="nx">base_runtime_spec</span><span class="p">=</span><span class="s2">&#34;&#34;</span> <span class="c"># 文件绝对路径，且内容为oci runtime文件格式</span>
        <span class="p">[</span><span class="nx">plugins</span><span class="p">.</span><span class="nx">cri</span><span class="p">.</span><span class="nx">containerd</span><span class="p">.</span><span class="nx">runtimes</span><span class="p">.</span><span class="nx">firecracker</span><span class="p">]</span>
         <span class="nx">runtime_type</span> <span class="p">=</span> <span class="s2">&#34;io.containerd.firecracker.v2&#34;</span>
    <span class="p">[</span><span class="nx">plugins</span><span class="p">.</span><span class="nx">cri</span><span class="p">.</span><span class="nx">cni</span><span class="p">]</span>
      <span class="nx">bin_dir</span> <span class="p">=</span> <span class="s2">&#34;/opt/cni/bin&#34;</span>
      <span class="nx">conf_dir</span> <span class="p">=</span> <span class="s2">&#34;/etc/cni/net.d&#34;</span>
      <span class="nx">max_conf_num</span> <span class="p">=</span> <span class="mi">1</span> <span class="c">#若有多个cni配置文件，则按照此值调用多个cni配置文件</span>
    <span class="p">[</span><span class="nx">plugins</span><span class="p">.</span><span class="nx">cri</span><span class="p">.</span><span class="nx">registry</span><span class="p">]</span>
        <span class="nx">config_path</span><span class="p">=</span> <span class="err">/</span><span class="nx">xxx</span> <span class="c"># 目录，若配置该值，则以下内容被忽略</span>
      <span class="p">[</span><span class="nx">plugins</span><span class="p">.</span><span class="nx">cri</span><span class="p">.</span><span class="nx">registry</span><span class="p">.</span><span class="nx">configs</span><span class="p">]</span> <span class="c">#被弃用，使用config_path代替，在1.7后被移除</span>
        <span class="p">[</span><span class="nx">plugins</span><span class="p">.</span><span class="nx">cri</span><span class="p">.</span><span class="nx">registry</span><span class="p">.</span><span class="nx">configs</span><span class="p">.</span><span class="s2">&#34;hub.easystack.io&#34;</span><span class="p">]</span>
          <span class="p">[</span><span class="nx">plugins</span><span class="p">.</span><span class="nx">cri</span><span class="p">.</span><span class="nx">registry</span><span class="p">.</span><span class="nx">configs</span><span class="p">.</span><span class="s2">&#34;hub.easystack.io&#34;</span><span class="p">.</span><span class="nx">tls</span><span class="p">]</span>
            <span class="nx">insecure_skip_verify</span> <span class="p">=</span> <span class="kc">true</span>
      <span class="p">[</span><span class="nx">plugins</span><span class="p">.</span><span class="nx">cri</span><span class="p">.</span><span class="nx">registry</span><span class="p">.</span><span class="nx">mirrors</span><span class="p">]</span> <span class="c">#被弃用，使用config_path代替，在1.7后被移除</span>
        <span class="p">[</span><span class="nx">plugins</span><span class="p">.</span><span class="nx">cri</span><span class="p">.</span><span class="nx">registry</span><span class="p">.</span><span class="nx">mirrors</span><span class="p">.</span><span class="s2">&#34;docker.io&#34;</span><span class="p">]</span>
          <span class="nx">endpoint</span> <span class="p">=</span> <span class="p">[</span><span class="s2">&#34;https://registry-1.docker.io&#34;</span><span class="p">]</span>
        <span class="p">[</span><span class="nx">plugins</span><span class="p">.</span><span class="nx">cri</span><span class="p">.</span><span class="nx">registry</span><span class="p">.</span><span class="nx">mirrors</span><span class="p">.</span><span class="s2">&#34;hub.easystack.io&#34;</span><span class="p">]</span>
          <span class="nx">endpoint</span> <span class="p">=</span> <span class="p">[</span><span class="s2">&#34;https://hub.easystack.io&#34;</span><span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="仓库配置">仓库配置</h3>
<ul>
<li>配置中会逐渐废弃单一文件配置方式，这里描述config_path</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">config_path= /opt/mycontainerd/hosts

# 目录内容
.
├── docker.io
│   └── hosts.toml
└── k8s.gcr.io
    └── hosts.toml

# hosts.toml内容
server = &#34;https://k8s.gcr.io&#34;

[host.&#34;https://k8s.gcr.io&#34;]
  skip_verify = true
  capabilities = [ &#34;pull&#34;, &#34;resolve&#34;, &#34;push&#34; ]
  ca: &#34;&#34; #文件路径或文件内容
</code></pre></td></tr></table>
</div>
</div></div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>更新于 2020-12-09</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="分享到 Twitter" data-sharer="twitter" data-url="https://yylt.github.io/2020/12/containerd%E7%B3%BB%E5%88%97-%E7%AE%80%E4%BB%8B/" data-title="Containerd系列-简介" data-hashtags="containerd,go"><i class="fab fa-twitter fa-fw"></i></a><a href="javascript:void(0);" title="分享到 Facebook" data-sharer="facebook" data-url="https://yylt.github.io/2020/12/containerd%E7%B3%BB%E5%88%97-%E7%AE%80%E4%BB%8B/" data-hashtag="containerd"><i class="fab fa-facebook-square fa-fw"></i></a><a href="javascript:void(0);" title="分享到 Hacker News" data-sharer="hackernews" data-url="https://yylt.github.io/2020/12/containerd%E7%B3%BB%E5%88%97-%E7%AE%80%E4%BB%8B/" data-title="Containerd系列-简介"><i class="fab fa-hacker-news fa-fw"></i></a><a href="javascript:void(0);" title="分享到 Line" data-sharer="line" data-url="https://yylt.github.io/2020/12/containerd%E7%B3%BB%E5%88%97-%E7%AE%80%E4%BB%8B/" data-title="Containerd系列-简介"><i data-svg-src="https://cdn.jsdelivr.net/npm/simple-icons@2.14.0/icons/line.svg"></i></a><a href="javascript:void(0);" title="分享到 微博" data-sharer="weibo" data-url="https://yylt.github.io/2020/12/containerd%E7%B3%BB%E5%88%97-%E7%AE%80%E4%BB%8B/" data-title="Containerd系列-简介"><i class="fab fa-weibo fa-fw"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/containerd/">containerd</a>,&nbsp;<a href="/tags/go/">go</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
        </section>
    </div>

    <div class="post-nav"></div>
</div>
<div id="comments"><div id="gitalk" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://github.com/gitalk/gitalk"></a>Gitalk</a>.
            </noscript></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">由 <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.88.1">Hugo</a> 强力驱动 | 主题 - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a>
                </div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2019 - 2021</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://yylt.github.io" target="_blank">yylt</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="回到顶部">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="查看评论">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.6.2/dist/gitalk.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/copy-tex.min.css"><link rel="stylesheet" href="/lib/mermaid/mermaid.min.css"><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/gitalk@1.6.2/dist/gitalk.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/smooth-scroll@16.1.3/dist/smooth-scroll.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/autocomplete.js@0.37.1/dist/autocomplete.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/algoliasearch@4.2.0/dist/algoliasearch-lite.umd.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.2.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.4.0/sharer.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/copy-tex.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/mhchem.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/mermaid@8.5.1/dist/mermaid.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":100},"comment":{"gitalk":{"admin":["yylt"],"clientID":"c852f7c383ed2030823f","clientSecret":"6b015b4f409cb0a64e1497420fe7146bbc3cebce","id":"2020-12-09T15:50:43+08:00","owner":"yylt","repo":"yylt.github.io","title":"Containerd系列-简介"}},"data":{"id-1":"classDiagram\n    class Meta{\n        +'ocispec.Platform' Platforms\n        +'map[string]string' Exports\n        +string[] Capabilities\n    }\n    class Plugin{\n        +Registration Registration\n        +Meta Meta\n        +string[] Requires\n        +object Config\n        +Err() error\n        +Instance() (object, error)\n    }\n    class Registration{\n        +string Type\n        +string ID\n        +string[] Requires\n        +object Config\n        +Init(context) Plugin\n        +URI() string\n    }"},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"algoliaAppID":"PASDMWALPK","algoliaIndex":"index.zh-cn","algoliaSearchKey":"b42948e51daaa93df92381c8e2ac0f93","highlightTag":"em","maxResultLength":10,"noResultsFound":"没有找到结果","snippetLength":50,"type":"algolia"}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
